---
import "../styles/global.css";
import BaseHead from "../components/BaseHead.astro";
import MazeBackground from "../components/mazeBackground.astro";
import ThemeIcon from "../components/ThemeIcon.astro";
import NavLink from "../components/NavLink.astro";
import SocialLinks from "../components/SocialLinks.astro";

export interface Props {
  title: string;
  description?: string;
  image?: string;
}
const { title, description, image } = Astro.props;
// Determine the current request path so we can highlight active nav links
const currentPath =
  typeof Astro.request !== "undefined" && Astro.request?.url
    ? new URL(Astro.request.url).pathname
    : "/";

function isActive(path: string) {
  if (path === "/") return currentPath === "/";
  return currentPath === path || currentPath.startsWith(path + "/");
}
---

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <BaseHead title={title} description={description} image={image} />

    <!-- Inline critical CSS for instant render -->
    <style is:inline>
      :root {
        --maze-line-color: #5d5066;
        --gradient-base-r: 208;
        --gradient-base-g: 219;
        --gradient-base-b: 203;
      }
      body {
        background-color: rgb(
          var(--gradient-base-r),
          var(--gradient-base-g),
          var(--gradient-base-b)
        );
        margin: 0;
        padding: 0;
        min-height: 100vh;
      }
      html.dark {
        --maze-line-color: #cc6600;
        --gradient-base-r: 0;
        --gradient-base-g: 0;
        --gradient-base-b: 0;
      }
      html.dark body {
        background-color: rgb(
          var(--gradient-base-r),
          var(--gradient-base-g),
          var(--gradient-base-b)
        );
      }
      html.dark nav,
      html.dark .nav-links a,
      html.dark footer {
        color: #fff;
      }
    </style>

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      rel="alternate"
      type="application/rss+xml"
      title="Ed Thomas | Blog"
      href="/rss.xml"
    />
  </head>
  <body class="min-h-screen">
    <MazeBackground>
      <div
        class="min-h-screen max-w-2xl mx-auto px-6 py-8 font-mono text-sm leading-relaxed flex flex-col"
      >
        <header class="mb-8 relative">
          <nav
            class="grid grid-cols-6 gap-x-2 gap-y-1 items-center justify-items-center md:flex md:flex-wrap md:justify-center md:gap-6 tracking-wide text-sm md:text-base pr-10 md:pr-0"
          >
            <NavLink href="/" label="HOME" isActive={isActive("/")} />
            <NavLink href="/blog" label="BLOG" isActive={isActive("/blog")} />
            <NavLink
              href="/projects"
              label="PROJECTS"
              isActive={isActive("/projects")}
            />
            <NavLink
              href="/misc"
              label="MISC"
              isActive={isActive("/misc")}
              colStart="col-start-2"
            />
            <NavLink
              href="/cv"
              label="CV"
              isActive={isActive("/cv")}
              colStart="col-start-4"
            />
          </nav>

          <div class="absolute right-2 top-2 z-10">
            <ThemeIcon />
          </div>
        </header>

        <main class="flex-1">
          <slot />
        </main>

        <footer class="mt-8 text-center">
          <SocialLinks />
        </footer>
      </div>
    </MazeBackground>
  </body>
</html>
