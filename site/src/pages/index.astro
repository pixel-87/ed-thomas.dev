---
import Layout from "../layouts/Layout.astro";
import { getCollection } from "astro:content";

// Get latest 5 blog posts
const allBlogPosts = await getCollection("blog");
const latestPosts = allBlogPosts
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 5);

// Get latest 3 projects
const allProjects = await getCollection("projects");
const latestProjects = allProjects
  .sort((a, b) => b.data.date.valueOf() - a.data.date.valueOf())
  .slice(0, 3);
---

<Layout title="Ed Thomas">
  <main class="space-y-12">
    <!-- Intro -->
    <section class="text-center">
      <h1 class="text-lg mb-4">Welcome to my personal website!</h1>
      <p class="text-gray-700">
        Hi! I'm Ed, a developer who likes making
        <a href="/blog" class="underline hover:no-underline">notes</a>,
        <a href="/projects" class="underline hover:no-underline">coding</a>, and
        learning new things.
      </p>
      <br />
      <p>
        <div class="text-gray-700">Try clicking / tapping!</div>
      </p>
    </section>

    <!-- Latest Notes -->
    <section>
      <h2 class="text-base font-bold mb-4">## Latest notes</h2>
      <div class="space-y-4">
        {
          latestPosts.map((post) => (
            <div class="min-h-[44px]">
              <a
                href={`/blog/${post.slug}`}
                class="hover:underline min-h-[44px] flex items-center px-2 py-2 -mx-2 rounded"
              >
                {post.data.title}
              </a>
              <span class="text-gray-500 ml-2 text-sm">
                {post.data.pubDate.toLocaleDateString("en-GB", {
                  year: "numeric",
                  month: "short",
                  day: "numeric",
                })}
              </span>
              {post.data.tags && post.data.tags.length > 0 && (
                <div class="flex gap-1 mt-1 pl-2">
                  {post.data.tags.map((tag) => (
                    <span class="bg-gray-100 text-gray-600 text-xs px-1.5 py-0.5 rounded">
                      {tag}
                    </span>
                  ))}
                </div>
              )}
            </div>
          ))
        }
        <div class="mt-1">
          <a
            href="/blog"
            class="hover:underline min-h-[36px] flex items-center px-2 py-1 -mx-2 rounded"
          >
            More notes →
          </a>
        </div>
      </div>
    </section>

    <!-- Projects -->
    <section>
      <h2 class="text-base font-bold mb-4">## Some things I've built</h2>
      <div class="space-y-6">
        {
          latestProjects.map((project) => (
            <div class="min-h-[44px]">
              <a
                href={`/projects/${project.slug}`}
                class="hover:underline font-medium min-h-[44px] flex items-center px-2 py-2 -mx-2 rounded"
              >
                {project.data.title}
              </a>
              <p class="text-gray-700 text-sm mt-1 pl-2">
                {project.data.description}
              </p>
              <div class="flex gap-2 mt-2 pl-2">
                {project.data.technologies.map((tech) => (
                  <span class="bg-gray-100 text-gray-700 text-xs px-2 py-1 rounded min-h-[32px] flex items-center">
                    {tech}
                  </span>
                ))}
              </div>
            </div>
          ))
        }
        <div class="mt-1">
          <a
            href="/projects"
            class="hover:underline min-h-[36px] flex items-center px-2 py-1 -mx-2 rounded"
          >
            More projects →
          </a>
        </div>
      </div>
    </section>

    <!-- About -->
    <section>
      <h2 class="text-base font-bold mb-4">## About me</h2>
      <div class="space-y-3">
        <p>
          I'm a final year computer science student at the University of Exeter.
        </p>
        <p>
          I really enjoy working with DevOps, backend systems, and cloud
          computing.
        </p>
        <p>
          I really like learning a little about everything, and throwing myself
          into new things.
        </p>
      </div>
    </section>

    <!-- Footer -->
    <footer class="text-center text-gray-500 text-xs border-t pt-6">
      <!--<p>Thanks for visiting. Have a look around!</p>-->
    </footer>
  </main>
</Layout>
