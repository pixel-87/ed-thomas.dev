---
import { type CollectionEntry, getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";

export async function getStaticPaths() {
  const blogEntries = await getCollection("blog");
  return blogEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

type Props = {
  entry: CollectionEntry<"blog">;
};

const { entry } = Astro.props;
// render content component for MDX/MD rendering
const { Content, remarkPluginFrontmatter } = await entry.render();

const minutes = remarkPluginFrontmatter.readingTime;
const publishedISO = entry.data.pubDate.toISOString();
---

<Layout title={entry.data.title}>
  <main>
    <article class="h-entry prose prose-sm max-w-none">
      <header class="mb-8">
        <h1 class="text-lg font-bold mb-2 p-name">{entry.data.title}</h1>
        <div class="muted text-xs mb-4">
          <div class="u-author h-card inline-block mr-2">
            <a class="u-url p-name" href="/cv">Edward Thomas</a>
          </div>
          <time class="dt-published" datetime={publishedISO}>
            {
              entry.data.pubDate.toLocaleDateString("en-US", {
                year: "numeric",
                month: "long",
                day: "numeric",
              })
            }
          </time>
          {` \u00b7 ${minutes} min read`}
        </div>
        {
          entry.data.tags && (
            <div class="flex gap-2 mb-4">
              {entry.data.tags.map((tag: string) => (
                <span class="bg-gray-100 text-xs px-2 py-1 rounded">{tag}</span>
              ))}
            </div>
          )
        }
      </header>

      <div class="e-content">
        <Content />
      </div>

      <footer class="mt-8 pt-4 border-t text-center">
        <a href="/blog" class="text-sm">‚Üê Back to notes</a>
      </footer>
    </article>
  </main>
</Layout>
