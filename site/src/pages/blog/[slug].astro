---
import { type CollectionEntry, getCollection } from "astro:content";
import Layout from "../../layouts/Layout.astro";
import { estimateReadingTime } from "../../lib/readingTime";

export async function getStaticPaths() {
  const blogEntries = await getCollection("blog");
  return blogEntries.map((entry) => ({
    params: { slug: entry.slug },
    props: { entry },
  }));
}

type Props = {
  entry: CollectionEntry<"blog">;
};

const { entry } = Astro.props;
// render content component for MDX/MD rendering
const { Content } = await entry.render();

// Estimate reading time from the raw entry body (fallback to empty string)
const raw = entry.body ?? "";
const { minutes } = estimateReadingTime(String(raw));
---

<Layout title={entry.data.title}>
  <main>
    <article class="prose prose-sm max-w-none">
      <header class="mb-8">
        <h1 class="text-lg font-bold mb-2">{entry.data.title}</h1>
        <div class="text-gray-500 text-xs mb-4">
          {
            entry.data.pubDate.toLocaleDateString("en-US", {
              year: "numeric",
              month: "long",
              day: "numeric",
            })
          }
          {` · ${minutes} min read`}
        </div>
        {
          entry.data.tags && (
            <div class="flex gap-2 mb-4">
              {entry.data.tags.map((tag: string) => (
                <span class="bg-gray-100 text-gray-600 text-xs px-2 py-1 rounded">
                  {tag}
                </span>
              ))}
            </div>
          )
        }
      </header>

      <Content />

      <footer class="mt-8 pt-4 border-t text-center">
  <a href="/blog" class="text-sm">← Back to notes</a>
      </footer>
    </article>
  </main>
</Layout>
