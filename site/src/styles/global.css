@tailwind base;
@tailwind components;
@tailwind utilities;

/* Screen reader only utility */
.sr-only {
  position: absolute;
  width: 1px;
  height: 1px;
  padding: 0;
  margin: -1px;
  overflow: hidden;
  clip-path: inset(50%);
  white-space: nowrap;
  border: 0;
}

.sr-only:focus {
  position: static;
  width: auto;
  height: auto;
  padding: inherit;
  margin: inherit;
  overflow: visible;
  clip: auto;
  white-space: normal;
}

@layer base {
  /* 
    Note: :root variables for colors are defined in Layout.astro 
    to prevent FOUC (Flash of Unstyled Content).
  */

  /* Content color variables are defined inline in Layout.astro to
     prevent FOUC (Flash of Unstyled Content) and keep critical tokens
     together. */

  body {
    background-color: rgb(
      var(--gradient-base-r),
      var(--gradient-base-g),
      var(--gradient-base-b)
    );
  }

  html.dark nav,
  html.dark .nav-links a,
  html.dark footer {
    color: #fff;
  }

  /* Regular links - no underline by default, underline on hover */
  a {
    color: inherit;
    text-decoration: none;
    transition: color 0.2s ease, text-decoration-color 0.2s ease;
  }

  a:hover,
  a:focus-visible {
    text-decoration: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
  }

  /* Prose links - underline by default for readability in long text */
  .prose a {
    text-decoration: underline;
    text-decoration-thickness: 1px;
    text-underline-offset: 2px;
  }

  .prose a:hover,
  .prose a:focus-visible {
    text-decoration: none;
  }

  /* Main content colors are enforced globally via variables in
     Layout.astro (applied inline to prevent FOUC). We re-apply a small set
     of utility rules at the end of this file to ensure content is readable
     across both light and dark modes. */
}

@layer components {
  /* Desktop gradient: soft fade with wide solid center */
  .gradient-overlay {
    --grad: rgba(var(--gradient-base-r), var(--gradient-base-g), var(--gradient-base-b));
    background: linear-gradient(
      to right,
      transparent 0%,
      color-mix(in srgb, var(--grad) 3%, transparent) 8%,
      color-mix(in srgb, var(--grad) 8%, transparent) 12%,
      color-mix(in srgb, var(--grad) 15%, transparent) 16%,
      color-mix(in srgb, var(--grad) 30%, transparent) 20%,
      color-mix(in srgb, var(--grad) 50%, transparent) 25%,
      color-mix(in srgb, var(--grad) 70%, transparent) 30%,
      color-mix(in srgb, var(--grad) 85%, transparent) 35%,
      color-mix(in srgb, var(--grad) 95%, transparent) 40%,
      color-mix(in srgb, var(--grad) 100%, transparent) 45%,
      color-mix(in srgb, var(--grad) 100%, transparent) 50%,
      color-mix(in srgb, var(--grad) 100%, transparent) 55%,
      color-mix(in srgb, var(--grad) 95%, transparent) 60%,
      color-mix(in srgb, var(--grad) 85%, transparent) 65%,
      color-mix(in srgb, var(--grad) 70%, transparent) 70%,
      color-mix(in srgb, var(--grad) 50%, transparent) 75%,
      color-mix(in srgb, var(--grad) 30%, transparent) 80%,
      color-mix(in srgb, var(--grad) 15%, transparent) 84%,
      color-mix(in srgb, var(--grad) 8%, transparent) 88%,
      color-mix(in srgb, var(--grad) 3%, transparent) 92%,
      transparent 100%
    );
  }

  html.dark .gradient-overlay {
    background: linear-gradient(
      to right,
      transparent 0%,
      color-mix(in srgb, var(--grad) 1%, transparent) 8%,
      color-mix(in srgb, var(--grad) 5%, transparent) 12%,
      color-mix(in srgb, var(--grad) 10%, transparent) 16%,
      color-mix(in srgb, var(--grad) 30%, transparent) 20%,
      color-mix(in srgb, var(--grad) 50%, transparent) 25%,
      color-mix(in srgb, var(--grad) 70%, transparent) 30%,
      color-mix(in srgb, var(--grad) 85%, transparent) 35%,
      color-mix(in srgb, var(--grad) 95%, transparent) 40%,
      var(--grad) 45%,
      var(--grad) 50%,
      var(--grad) 55%,
      color-mix(in srgb, var(--grad) 95%, transparent) 60%,
      color-mix(in srgb, var(--grad) 85%, transparent) 65%,
      color-mix(in srgb, var(--grad) 70%, transparent) 70%,
      color-mix(in srgb, var(--grad) 50%, transparent) 75%,
      color-mix(in srgb, var(--grad) 30%, transparent) 80%,
      color-mix(in srgb, var(--grad) 10%, transparent) 84%,
      color-mix(in srgb, var(--grad) 5%, transparent) 88%,
      color-mix(in srgb, var(--grad) 1%, transparent) 92%,
      transparent 100%
    );
  }

  /* Tablet: tighten gradient to preserve content area */
  @media (max-width: 1024px) {
    .gradient-overlay {
      background: linear-gradient(
        to right,
        transparent 0%,
        color-mix(in srgb, var(--grad) 5%, transparent) 5%,
        color-mix(in srgb, var(--grad) 15%, transparent) 10%,
        color-mix(in srgb, var(--grad) 40%, transparent) 15%,
        color-mix(in srgb, var(--grad) 70%, transparent) 20%,
        color-mix(in srgb, var(--grad) 100%, transparent) 25%,
        color-mix(in srgb, var(--grad) 100%, transparent) 50%,
        color-mix(in srgb, var(--grad) 100%, transparent) 75%,
        color-mix(in srgb, var(--grad) 70%, transparent) 80%,
        color-mix(in srgb, var(--grad) 40%, transparent) 85%,
        color-mix(in srgb, var(--grad) 15%, transparent) 90%,
        color-mix(in srgb, var(--grad) 5%, transparent) 95%,
        transparent 100%
      );
    }

    html.dark .gradient-overlay {
      background: linear-gradient(
        to right,
        transparent 0%,
        color-mix(in srgb, var(--grad) 5%, transparent) 5%,
        color-mix(in srgb, var(--grad) 15%, transparent) 10%,
        color-mix(in srgb, var(--grad) 40%, transparent) 15%,
        color-mix(in srgb, var(--grad) 70%, transparent) 20%,
        var(--grad) 25%,
        var(--grad) 50%,
        var(--grad) 75%,
        color-mix(in srgb, var(--grad) 70%, transparent) 80%,
        color-mix(in srgb, var(--grad) 40%, transparent) 85%,
        color-mix(in srgb, var(--grad) 15%, transparent) 90%,
        color-mix(in srgb, var(--grad) 5%, transparent) 95%,
        transparent 100%
      );
    }
  }

  /* Mobile: aggressive tight gradient to preserve text area */
  @media (max-width: 640px) {
    .gradient-overlay {
      background: linear-gradient(
        to right,
        transparent 0%,
        color-mix(in srgb, var(--grad) 15%, transparent) 3%,
        color-mix(in srgb, var(--grad) 50%, transparent) 8%,
        color-mix(in srgb, var(--grad) 80%, transparent) 12%,
        color-mix(in srgb, var(--grad) 92%, transparent) 20%,
        color-mix(in srgb, var(--grad) 100%, transparent) 50%,
        color-mix(in srgb, var(--grad) 92%, transparent) 80%,
        color-mix(in srgb, var(--grad) 80%, transparent) 88%,
        color-mix(in srgb, var(--grad) 50%, transparent) 92%,
        color-mix(in srgb, var(--grad) 15%, transparent) 97%,
        transparent 100%
      );
    }

    html.dark .gradient-overlay {
      background: linear-gradient(
        to right,
        transparent 0%,
        color-mix(in srgb, var(--grad) 15%, transparent) 3%,
        color-mix(in srgb, var(--grad) 50%, transparent) 8%,
        color-mix(in srgb, var(--grad) 80%, transparent) 12%,
        color-mix(in srgb, var(--grad) 92%, transparent) 20%,
        color-mix(in srgb, var(--grad) 95%, transparent) 50%,
        color-mix(in srgb, var(--grad) 92%, transparent) 80%,
        color-mix(in srgb, var(--grad) 80%, transparent) 88%,
        color-mix(in srgb, var(--grad) 50%, transparent) 92%,
        color-mix(in srgb, var(--grad) 15%, transparent) 97%,
        transparent 100%
      );
    }
  }

  /* Article prose styling */
  article.prose {
    max-width: 65ch;
    line-height: 1.7;
  }

  @media (min-width: 1024px) {
    article.prose {
      max-width: 75ch;
    }
  }

  /* Obsidian-like callout styling for blockquotes */
  .prose blockquote {
    border-left: 4px solid var(--tw-prose-quote-borders);
    background-color: rgba(209, 213, 219, 0.08);
    padding: 0.75rem 2.5rem;
    margin: 1.25rem 0;
    border-radius: 0.375rem;
    position: relative;
  }

  .prose blockquote::before {
    content: "";
    position: absolute;
    left: calc(4px + 1.25rem);
    transform: translateX(-50%);
    top: 0.6rem;
    font-size: 1rem;
  }

  .prose blockquote p:first-child {
    margin-top: 0;
  }

  .prose blockquote p:last-child {
    margin-bottom: 0;
  }

  html.dark .prose blockquote {
    background-color: rgba(55, 65, 81, 0.32);
    border-left-color: var(--tw-prose-quote-borders);
  }

  html.dark .prose blockquote::before {
    content: "";
  }

  /* Explicit callout blocks */
  .callout {
    display: block;
    padding: 0.75rem 2.5rem;
    border-radius: 0.375rem;
    margin: 1rem 0;
    position: relative;
  }

  .callout .callout-heading {
    font-weight: 700;
    margin-bottom: 0.25rem;
  }

  .callout::before {
    content: "";
    position: absolute;
    left: calc(4px + 1.25rem);
    transform: translateX(-50%);
    top: 0.6rem;
  }

  .callout.note {
    border-left: 4px solid #2563eb;
    background: rgba(37, 99, 235, 0.06);
  }

  .callout.warning {
    border-left: 4px solid #f59e0b;
    background: rgba(245, 158, 11, 0.06);
  }

  .callout.success {
    border-left: 4px solid #10b981;
    background: rgba(16, 185, 129, 0.06);
  }

  .callout :where(p, ul, ol, pre, code) {
    margin: 0.25rem 0;
  }

  /* Custom dash marker for unordered lists
     Use a larger en-dash glyph and theme-aware color so the marker is
     visible in both light and dark modes. */
  ul.list-dash > li::marker {
    content: "– "; /* en-dash for better visibility */
    font-weight: 700;
    color: var(--muted-color);
  }

  /* Ensure list-dash marker color is readable in dark mode too */
  html.dark ul.list-dash > li::marker {
    color: var(--muted-color);
  }

  /* Terminal breadcrumb styles */
  .terminal-path {
    color: var(--content-color);
  }

  .terminal-cursor {
    background: var(--content-color);
  }

  @keyframes blink {
    0%,
    50% {
      opacity: 1;
    }
    51%,
    100% {
      opacity: 0;
    }
  }

  .animate-blink {
    animation: blink 1s step-end infinite;
  }
}

@layer utilities {
  /* Main content enforcement: use inline variables from Layout.astro */
  main,
  main h1,
  main h2,
  main h3,
  main h4,
  main h5,
  main h6,
  main p,
  main li {
    color: var(--content-color);
  }

  main a,
  main p,
  main li,
  main h1,
  main h2,
  main h3 {
    color: var(--content-color);
  }

  /* Muted text (dates, helper text) */
  .muted,
  main .muted,
  main small,
  main .text-muted {
    color: var(--muted-color);
  }

  /* Badge/tag pills in light mode should use a darker label color for legibility */
  main .bg-gray-100 {
    color: var(--badge-text);
  }

  /* Dark-mode utility overrides */
  html.dark .text-gray-700 {
    color: #d1d5db; /* gray-300 */
  }

  html.dark .text-gray-800 {
    color: #e5e7eb; /* gray-200 */
  }

  html.dark .text-gray-900 {
    color: #ffffff; /* white for primary headings */
  }

  html.dark .text-gray-600 {
    color: #9ca3af; /* gray-400 */
  }

  html.dark .text-gray-500,
  html.dark .text-gray-400 {
    color: #9ca3af; /* gray-400 */
  }

  html.dark .bg-gray-100 {
    background-color: #111827; /* dark badge bg */
  }

  html.dark .text-gray-700.bg-gray-100 {
    color: #e5e7eb; /* badge text */
  }

  html.dark .border-t {
    border-color: rgba(255, 255, 255, 0.06);
  }

  /* Ensure prose headings remain readable in dark mode. Sometimes the
     Tailwind `prose` token values can be out of sync with site-wide
     content tokens — prefer the centralized `--content-color` on headings
     to avoid low-contrast headings. */
  html.dark .prose :where(h1,h2,h3,h4,h5,h6) {
    color: var(--content-color);
  }
  /* Improve callout visibility in dark mode */
  html.dark .callout {
    color: var(--content-color);
  }

  html.dark .callout.note {
    border-left-color: #60a5fa; /* lighter blue */
    background: rgba(96,165,250,0.12);
  }

  html.dark .callout.warning {
    border-left-color: #fb923c; /* lighter orange */
    background: rgba(251,146,60,0.12);
  }

  html.dark .callout.success {
    border-left-color: #34d399; /* lighter green */
    background: rgba(52,211,153,0.10);
  }

  html.dark .callout .callout-heading {
    color: var(--content-color);
  }

  html.dark .callout :where(p, ul, ol, pre, code) {
    color: var(--content-color);
  }

  /* Improve code block and inline code contrast in dark mode */
  html.dark pre,
  html.dark .prose pre {
    background-color: rgba(255, 255, 255, 0.04);
    border: 1px solid rgba(255, 255, 255, 0.06);
    color: var(--content-color);
    border-radius: 0.5rem;
    padding: 1rem;
    overflow: auto;
  }

  html.dark code,
  html.dark .prose code {
    background-color: rgba(255, 255, 255, 0.03);
    color: var(--content-color);
    padding: 0.12rem 0.32rem;
    border-radius: 0.25rem;
  }

}
